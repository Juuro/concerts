# .cursorrules: Universal AI Instructions for Next.js Project

## Core Stack

- Next.js 15+ App Router, TypeScript 5.6+, Yarn 4+ (yarn only, no npm/pnpm)
- SCSS Modules (.module.scss) and global SCSS only
- Zod validation, React 19 server/client components
- Sass/SCSS with modules support (sass package required)

## Structure Expectations

src/
app/ # Pages & API routes
components/ # UI components  
 lib/ # Utils, DB, API clients
types/ # Shared TS types
styles/ # Global SCSS files
Root: next.config.js, tsconfig.json (absolute imports), yarn.lock

## Commands

yarn dev/build/lint/test/clean

## Rules (Always Follow)

- TypeScript everywhere; strict null checks.
- 'use client' directive for client components only.
- Functional hooks only; PascalCase components.
- Global SCSS: src/styles/globals.scss for resets/base only
- Zod for all inputs; try/catch error handling.
- Absolute imports from src/.
- When fixing a bug or an error analyse the code carefully. Make sure to break nothing else when fixing something!

## Styling Guidelines

- SCSS Modules required: Component.module.scss co-located with components
- Import pattern: const { container, button } = styles;
- Nesting, variables ($primary-color), mixins in SCSS modules
- Global SCSS limited to resets, typography, spacing variables
- CSS custom properties + SCSS variables for theming
- Flexbox/Grid layouts; mobile-first responsive design
- No inline styles whatsoever

## Prohibited

- Modify yarn.lock manually.
- Tailwind CSS, CSS-in-JS (styled-components, emotion), vanilla CSS.
- Global SCSS beyond base styles (no component-specific rules).
- Class components or JS files.

## Generation Style

- Concise, readable code with JSDoc for complex logic.
- Prefer server components; explicit client boundaries.
- Vitest + React Testing Library for tests.

## Features

### Feature flags

- In .env feature flags can turned on or turned off
- There are currently these feature flags:
  - ENABLE_LASTFM
  - ENABLE_GEOCODING

### Last.fm for artist genres

- Calls Last.fm: prebuild only via scripts/prefetch-lastfm.mjs.
- Stores results: .next/cache/lastfm-artists.json (fallback .cache/lastfm-artists.json).
- Build uses cached data: src/utils/data.ts reads the cache and attaches band.lastfm.
- Pages never call Last.fm directly; they only render band.lastfm when ENABLE_LASTFM=true.
